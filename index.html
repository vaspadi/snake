<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Snake 2</title>
</head>

<body>
	<div class="game">
		<canvas id="canvas" width="700" height="700"></canvas>
		<div id="score"></div>
		<button id="test-button">Click!</button>
	</div>

	<script>
		const canvas = document.getElementById('canvas');
		const score = document.getElementById('score');
		const button = document.getElementById('test-button');
		const ctx = canvas.getContext('2d');
		const width = canvas.width;
		const height = canvas.height;
		const blockSize = width / 22;

		function drawBorder() {
			ctx.strokeStyle = '#ccc';
			ctx.lineWidth = blockSize * 2;
			ctx.strokeRect(0, 0, width, height);
		}

		let Block = function(col, row) {
			this.col = col;
			this.row = row;
		}

		Block.prototype.drawSquare = function(color) {
			let x = this.col * blockSize;
			let y = this.row * blockSize;
			
			ctx.fillStyle = color;
			ctx.fillRect(x, y, blockSize, blockSize);
		}

		Block.prototype.drawCircle = function(color) {
			let centerX = this.col * blockSize + blockSize / 2;
			let centerY = this.row * blockSize + blockSize / 2;

			ctx.fillStyle = color;
			ctx.arc(centerX, centerY, blockSize / 2, 0, Math.PI * 2, false);
			ctx.fill();
		}

		Block.prototype.equal = function(otherBlock) {
			return this.col === otherBlock.col && this.row === otherBlock.row;
		}

		let Snake = function() {
			this.segments = [
				new Block(3, 1),
				new Block(2, 1),
				new Block(1, 1)
			];
			this.direction = 'right';
			this.nextDirection = 'right';
		}

		Snake.prototype.draw = function() {
			for (let i = 0; i < this.segments.length; i++) {
				this.segments[i].drawSquare('blue');
			}
		}

		Snake.prototype.move = function() {
			let head = this.segments[0];
			let newHead;
			this.direction = this.nextDirection;

			if (this.direction === 'right') {
				newHead = new Block(head.col + 1, head.row);
			} else if (this.direction === 'down') {
				newHead = new Block(head.col, head.row + 1);
			} else if (this.direction === 'left') {
				newHead = new Block(head.col - 1, head.row);
			} else if (this.direction === 'up') {
				newHead = new Block(head.col, head.row - 1);
			}

			this.segments.unshift(newHead);
			this.segments.pop();
		}

		let directions = {
			37: 'left',
			38: 'up',
			39: 'right',
			40: 'down'
		}

		window.addEventListener('keydown', function(event) {
			let newDirection = directions[event.keyCode];
			if (newDirection !== undefined) snake.setDirection(newDirection);
		});

		Snake.prototype.setDirection = function(newDirection) {
			if (this.direction === 'up' && newDirection === 'down') {
				return;
			} else if (this.direction === 'right' && newDirection === 'left') {
				return;
			} else if (this.direction === 'down' && newDirection === 'up') {
				return;
			} else if (this.direction === 'left' && newDirection === 'right') {
				return;
			}

			this.nextDirection = newDirection;
		}


		
		let snake = new Snake();

		let intervalId = setInterval(function() {
			ctx.clearRect(0, 0, width, height);
			snake.move();
			snake.draw();
			drawBorder();
		}, 500);

		button.addEventListener('click', function () {
			
		});
	</script>
</body>

</html>